---
import { getLangFromUrl } from '../i18n/utils';
import { languages } from '../i18n/ui';

const lang = getLangFromUrl(Astro.url);
const currentPath = Astro.url.pathname;

function getPathForLang(targetLang: string) {
    if (targetLang === lang) return currentPath;
    
    const isEnglishPath = currentPath.startsWith('/en');
    
    if (targetLang === 'es') {
        if (isEnglishPath) {
             const newPath = currentPath.replace(/^\/en/, '');
             return newPath || '/';
        }
        return currentPath;
    } else { // targetLang === 'en'
        if (!isEnglishPath) {
             return `/en${currentPath === '/' ? '' : currentPath}`;
        }
        return currentPath;
    }
}
---

<header class="sticky top-0 z-50 w-full border-b border-zinc-800 bg-zinc-950/80 backdrop-blur-xl supports-[backdrop-filter]:bg-zinc-950/60">
    <div class="mx-auto flex h-16 max-w-7xl items-center justify-between px-4 sm:px-6 lg:px-8">
        <a href={lang === 'es' ? '/' : '/en'} class="group flex items-center gap-3 transition-opacity hover:opacity-80">
            <div class="flex h-8 w-8 items-center justify-center border border-zinc-800 bg-zinc-900/50 shadow-sm transition-colors group-hover:border-zinc-700 group-hover:bg-zinc-800">
                <img src="/icon.svg" alt="Logo" class="h-5 w-5 object-contain opacity-90 transition-transform duration-300 group-hover:scale-110" />
            </div>
            <span class="hidden font-mono text-sm font-medium tracking-tight text-zinc-300 sm:inline-block">
                OLIVER MART√çNEZ HARO
            </span>
        </a>

        <nav>
            <ul class="flex items-center gap-1 border border-zinc-800/50 bg-zinc-900/50 p-1">
                {Object.entries(languages).map(([l, label]) => (
                    <li>
                        <a 
                            href={getPathForLang(l)}
                            class:list={[
                                "block px-3 py-1 text-xs font-bold uppercase transition-all duration-300",
                                l === lang 
                                    ? "bg-zinc-800 text-zinc-100 shadow-sm" 
                                    : "text-zinc-500 hover:bg-zinc-800/50 hover:text-zinc-300"
                            ]}
                            aria-label={`Switch to ${label}`}
                        >
                            {l}
                        </a>
                    </li>
                ))}
            </ul>
        </nav>
    </div>
</header>